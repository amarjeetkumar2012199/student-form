<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Student Entry Form</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"/>
</head>
<body class="bg-light">

<div class="container mt-5">
  <div class="card shadow">
    <div class="card-header text-center bg-primary text-white">
      <h3>Student Entry Form</h3>
    </div>
    <div class="card-body">
      <form id="studentForm">

        <div class="form-group">
          <label>Student's Name</label>
          <input type="text" class="form-control" name="studentName" required>
        </div>

        <div class="form-group">
          <label>Fatherâ€™s Name</label>
          <input type="text" class="form-control" name="fatherName" required>
        </div>

        <div class="form-group">
          <label>Mobile Number</label>
          <input type="tel" class="form-control" name="mobile" required>
        </div>

        <div class="form-group">
          <label>Date of Birth</label>
          <input type="date" class="form-control" name="dob" required>
        </div>

        <div class="form-group">
          <label>Receipt Number</label>
          <input type="text" class="form-control" name="receiptNo">
        </div>

        <div class="form-group">
          <label>Admission Date</label>
          <input type="date" class="form-control" name="admissionDate" required>
        </div>

        <div class="form-group">
          <label>Batch</label>
          <select class="form-control" name="batch" required>
            <option value="">Select Batch</option>
            <option value="Morning">Morning</option>
            <option value="Evening">Evening</option>
            <option value="Weekend">Weekend</option>
          </select>
        </div>

        <div class="form-group">
          <label>Fee (Optional)</label>
          <input type="number" class="form-control" name="fee">
        </div>

        <div class="form-group">
          <label>Note</label>
          <textarea class="form-control" name="note" rows="3"></textarea>
        </div>

        <!-- PHOTO UPLOAD -->
        <div class="form-group">
          <label>Upload Photo</label>
          <input type="file" class="form-control-file" id="photoUpload" accept="image/*">
        </div>

        <!-- CAMERA -->
        <div class="form-group">
          <label>Or Capture Photo</label><br/>
          <video id="camera" width="320" height="240" autoplay class="border"></video><br/>
          <button type="button" class="btn btn-sm btn-info mt-2" onclick="capturePhoto()">Capture</button>
          <canvas id="capturedPhoto" width="320" height="240" style="display:none;"></canvas>
        </div>

        <input type="hidden" name="photoBase64" id="photoBase64" />

        <button type="submit" class="btn btn-success btn-block">Submit</button>
      </form>
    </div>
  </div>
</div>

<script>
  // Webcam Setup
  const video = document.getElementById('camera');
  const canvas = document.getElementById('capturedPhoto');
  const base64Input = document.getElementById('photoBase64');

  navigator.mediaDevices.getUserMedia({ video: true })
    .then(stream => { video.srcObject = stream; })
    .catch(err => console.log("Camera not accessible:", err));

  function capturePhoto() {
    const context = canvas.getContext('2d');
    canvas.style.display = 'block';
    context.drawImage(video, 0, 0, canvas.width, canvas.height);
    const base64 = canvas.toDataURL('image/jpeg');
    base64Input.value = base64;
  }

  // Upload to Base64
  document.getElementById('photoUpload').addEventListener('change', function(e) {
    const file = e.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onloadend = () => {
        base64Input.value = reader.result;
      };
      reader.readAsDataURL(file);
    }
  });

  // Handle Form Submission (you can modify as per backend)
  document.getElementById('studentForm').addEventListener('submit', function(e) {
    e.preventDefault();
    const formData = new FormData(this);
    const json = {};
    formData.forEach((value, key) => json[key] = value);

    fetch('https://yhwohk6jei.execute-api.eu-north-1.amazonaws.com/prod', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(json)
    })
    .then(res => res.ok ? alert('Submitted successfully!') : alert('Error submitting'))
    .catch(() => alert('Submission failed'));
  });
</script>

</body>
</html>
